Review kartoza-timesheet-app and kartoza-video-processor prompt logs and set up new PostgreSQL AI project
.envrc setup for direnv
Add progress bar to schema harvesting, ensure only schema metadata is fetched
Harvester should traverse all database schemas and show status messages (schema/entity info under progress bar)
Replace database connections ASCII art with structured table showing harvest status icons
Fix query screen: remove large ASCII art, fix keybindings (esc, ctrl+c, ctrl+s/tab to execute)
Query input should stretch to full width with vim mode editor (using vimtea library)
Provide option to toggle between vim mode and simple editor mode in settings
Show generated SQL after interpreting prompt, history page for previous prompts per connection
Splash screen at startup with --nosplash flag, remove main menu ASCII banner
Add ctrl+c/esc to cancel schema harvesting and return to database selection
Fix layout: header/content/footer horizontal centering, footer at bottom, cache icon rendering, highlighted row rendering
Fix esc/ctrl+c key handling in database connections screen
Stay on menu at startup instead of auto-connecting to last service
Ensure arrow keys work alongside vim bindings (j/k) for menu navigation - already implemented
Fix initial layout issue where content is scrunched before terminal size is received
Fix F1 button to return to main menu
Improve query performance with persistent database connection, fix ctrl+c key handling in query screen
Add pagination for query results (n/→: next, p/←: prev, g: first, G: last), ensure editor box is 5 lines high
Fix query editor text display, move vim status bar outside editor box with glyphs
If user tries to access history without active connection, redirect to database selection first then navigate to history
Remove ASCII art from schema harvest progress page
Remove ASCII art banner from settings page
Add R keybind on connections page to force reharvest schema for selected service
Implement settings page with vim mode toggle, query editor respects vim mode setting with fallback to simple textarea
Add pg_service.conf management: show dialog for new entry when file missing, support for editing (e) and creating (n) service entries
Implement endless scroll pagination for query results (replaces page-based navigation with smooth scrolling)
Fix query editor widget showing as only 1 row high on initial load - set editor size in Init() when dimensions are known
Add semantic search for exploratory queries like "do I have any water related data" - searches table/column names for keywords
Replace hardcoded thesaurus with intelligent semantic matching algorithm using: stemming (rivers→river), Levenshtein distance (fuzzy matching), n-gram similarity, prefix/suffix matching, camelCase/snake_case splitting. Matches "water" to "watershed", "hydrology" to "hydro", etc. without predefined lists
Add ctrl+h shortcut on query screen to quickly jump to history
Add ctrl+l shortcut to clear the response/results area
Fix SQL generation to use quoted identifiers for table/schema names, add EXPLAIN validation before executing queries to catch invalid SQL early
Combine results from multiple matching tables with UNION ALL when asking about a feature type (e.g. "roads") that exists in several tables
If results contain PostGIS geometries, render them to PNG and display using Kitty graphics protocol in the response area
When a PNG geometry image is generated, show a photo glyph in query history and add a button (v key) to view the image. Cache geometry images as files in the config folder.
Query results and description should be tabbed with focus on Results tab. User can switch to Description tab to see underlying SQL logic.
Schema cache should be persistent until user manually refreshes it (R key on connections screen), no auto-invalidation after time period
Hide SQL box in a separate tab - Results tab shows only the data table, SQL tab shows the generated query and details
Fix schema cache not persisting between application runs - ensure CachedSchemas map is initialized before saving
2026-01-21 00:53:52 - User requested: Redesign query screen to have scrollable conversation flow with user queries interspersed between result tables, SQL box hidden by default with 's' toggle button per entry. Implemented conversation-style scrollable interface replacing the old tab-based view.
2026-01-21 01:05:16 - User requested: Train a neural network using Gorgonia to learn from query history (natural language -> SQL pairs) and use predictions to support user queries. Implemented:
- internal/nn/tokenizer.go: Text tokenization for NL and SQL queries
- internal/nn/model.go: Seq2Seq neural network model using Gorgonia
- internal/nn/trainer.go: Training data extraction and model training from history
- Updated internal/llm/engine.go to integrate NN predictions
- Added NeuralNetEnabled setting to config
- Fixed schema cache persistence by handling schemaLoadedMsg in harvest.go
2026-01-21 - User reported: "harvesting just never ends and it still has no concept of a retained schema cache between usages". Fixed:
- Added harvestCompleteMsg to properly signal when harvest channel closes
- Added comprehensive debug logging throughout harvest and app flow
- Fixed message flow so schemaLoadedMsg properly propagates from harvest to app
- Debug logs written to /tmp/kartoza-pg-ai-debug.log for troubleshooting
2026-01-21 - User requested: "the scroll area should be scrollable with a mouse too" and "cannot see the query by pressing s since s is caught by the vim text editor" and "how do I move focus out of the editor". Implemented:
- Added mouse wheel scroll support to conversation area (tea.WithMouseCellMotion)
- Changed SQL toggle from 's' to 'ctrl+g' to avoid vim conflict
- Added focus management: Esc (in normal mode) leaves editor, 'i' or Enter returns to editor
- When not focused on editor: j/k for scroll, Tab for selecting entries, ctrl+g for SQL toggle
- Visual indicators: editor border turns gray when not focused, help text changes based on focus
